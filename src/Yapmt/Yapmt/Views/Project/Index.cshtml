@model Yapmt.ViewModels.ProjectViewModel
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var completedTaskCount = Model.Project.Tasks.Where(t => t.Completed).Count();
    var inTimeTaskCount = Model.Project.Tasks.Where(t => !t.Completed && t.DueDate >= DateTime.Today).Count();
    var lateTaskCount = Model.Project.Tasks.Where(t => !t.Completed && t.DueDate < DateTime.Today).Count();
}

<script>

    $(function () {
        $("#deleteProject").click(function () {
            var data = window.projectToDeleteId;

            $.post("/Project/Delete", { id: data },
                function () { window.location.href = "/" });
        });

        $("#btnAddTask").click(function () {
            var description = $('#addTaskDescription').val();
            var owner = $('#addTaskOwner').val();
            var dueDate = $('#addTaskDueDate').val();

            if (description === "" || owner === "" || dueDate === "") {
                $('#taskAddInfo').css("visibility", "visible");
            }
            else {

                var data = {
                    description: $('#addTaskDescription').val(),
                    owner: $('#addTaskOwner').val(),
                    dueDate: $('#addTaskDueDate').val(),
                    completed: false
                };

                $.post("/Project/AddTask", { projectId: @Model.Project.Id, task: data },
                    function () { location.reload(); });
            }
        });
    });

    function setProjectToDelete(id) {
        window.projectToDeleteId = id;
    }

</script>

<div class="project-details">
    <h2>@Model.Project.Name</h2>
    <span class="taskStatus">@completedTaskCount /     @lateTaskCount / @Model.Project.Tasks.Count</span>
    <a class="project-delete" onclick="setProjectToDelete(@Model.Project.Id);" href="#" data-toggle="modal" data-target="#delProjModal">
        <span class="glyphicon glyphicon-trash"></span>
    </a>
</div>

<div class="addTask-box">
    <div>
        <div class="row">
            <div class="form-group col-lg-6 col-md-6 col-sm-6">
                <label for="addTaskDescription">Description</label>
                <input type="text" class="form-control" id="addTaskDescription" placeholder="Description">
            </div>
            <div class="form-group col-lg-2 col-md-2 col-sm-2">
                <label for="addTaskOwner">Owner</label>
                <input type="text" class="form-control" id="addTaskOwner" placeholder="Owner">
            </div>
            <div class="form-group col-lg-2 col-md-2 col-sm-2">
                <label for="addTaskDueDate">Due Date</label>
                <input type="date" id="addTaskDueDate" class="form-control" placeholder="Due Date" name="bday">
            </div>
            <div class="col-lg-1 col-md-1 col-sm-1">
                <label for="addTaskDueDate"></label>
                <button id="btnAddTask" class="btn btn-primary">Add Task</button>
            </div>
        </div>
    </div>
    <small id="taskAddInfo" class="form-text text-muted" style="color:red; visibility:hidden;">
        Please fill in all fields.
    </small>
</div>


<table class="table">
    <thead>
        <tr>
            <th scope="col">Completed</th>
            <th scope="col">Description</th>
            <th scope="col">Owner</th>
            <th scope="col">Due Date</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var task in Model.Project.Tasks.OrderBy(t => t.DueDate))
        {
            var status = task.Completed ? "" : task.DueDate < DateTime.Today ? "danger" : "";
            var strikeClass = task.Completed ? "strike" : "";

            <tr class="@strikeClass @status">
                <td scope="row">
                    <input type="checkbox" checked="@task.Completed" class="form-check-input" id="checkTask-@task.Id">
                    <script>
                        $(function () {
                            $("#checkTask-@task.Id").change(function () {
                                window.location.href = "/Project/CompleteTask/@task.Id";
                            });
                        });
                    </script>
                </td>
                <td>@task.Description</td>
                <td>@task.Owner</td>
                <td>@task.DueDate.ToShortDateString()</td>
            </tr>
        }
    </tbody>
</table>

<!-- Modal Delete Project-->
<div class="modal fade" id="delProjModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Delete Project</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are You sure you want to delete this project?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" id="deleteProject" class="btn btn-primary">Delete</button>
            </div>
        </div>
    </div>
</div>







